name: Create Preview PR
on:
  push:
    branches:
      - 'claude/**'
      - 'codex/**'
      - 'antigravity/**'
permissions:
  contents: write
  pull-requests: write
jobs:
  create-preview-pr:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check & Create PR
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          BRANCH=${GITHUB_REF#refs/heads/}
          EXISTING=$(gh pr list --head $BRANCH --json number -q '.[0].number')
          if [ -z "$EXISTING" ]; then
            gh pr create --title "üîç Preview: $BRANCH" --body "## Ready for Review using Netlify Preview (SEO Protected). Comment 'approve' to merge." --base main --head $BRANCH --label "preview"
          else
            echo "PR already exists: #$EXISTING"
          fi
